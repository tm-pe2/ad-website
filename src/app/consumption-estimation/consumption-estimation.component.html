<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;600&family=Roboto:wght@100;300;400;500&display=swap" rel="stylesheet">
<div class="row"> 
    <div class="col-md-12 col-md-offset-3">
        <!-- 1st Form : Service-->
        <form [formGroup]="serviceChoiceForm" id="forms">
            <ul id="progressbar">
                <li [ngClass]="step>=1 ? 'active ' : 'inactive'">Service</li>
                <li [ngClass]="step>=2 ? 'active' : 'inactive'">Family Compound</li>
                <li [ngClass]="step>=3 ? 'active' : 'inactive'">Meter</li>
                <li [ngClass]="step==4 ? 'active' : 'inactive'">Consumption</li>
            </ul>
            <fieldset  *ngIf="step == 1" >
                <h2 class="form-header">Service</h2>
                
                <mat-radio-group formControlName="choice" class="flex place-content-evenly">
                    <mat-radio-button name="Electricity" [ngClass]="{ 'is-invalid': service_step && service['choice'].errors }" value="0" class="block px-3.5">Electricity</mat-radio-button>
                    <mat-radio-button name="Gas" [ngClass]="{ 'is-invalid': service_step && service['choice'].errors }" value="1" class="block px-3.5">Gas</mat-radio-button>
                    <mat-radio-button name="Both" [ngClass]="{ 'is-invalid': service_step && service['choice'].errors }" value="2" class="block px-3.5">Both</mat-radio-button>
                </mat-radio-group>

                <div *ngIf="service_step && serviceChoiceForm.controls['choice'].errors">
                    <div class="required" *ngIf="service['choice'].errors?.['required']">*Choice is required</div>
                </div>

                <input (click)="next()" type="button" name="next" class="next action-button" value="Next"/>
           
            </fieldset>
        </form> 
        <!--2nd Form : Address and family-->
         <form [formGroup]="familyAdressCompoundForm" id="forms">
            <fieldset *ngIf="step == 2" >
                <h2 class="form-header">Address</h2>
            
                <div class="flex place-content-evenly ">
                    <input type="text" formControlName="city"  placeholder="City" class="mr-1"/>        
                    <input type="text" formControlName="postcode"  placeholder="Postcode"/>
                </div>

                <div class="flex place-content-evenly ">
                    <div *ngIf="familyAdress_step && familyAdressCompoundForm.controls['city'].errors">
                        <div class="required" *ngIf="familyAddress['city'].errors?.['required']">*City is required</div>
                    </div>

                    <div *ngIf="familyAdress_step && familyAdressCompoundForm.controls['postcode'].errors">
                        <div class="required" *ngIf="familyAddress['postcode'].errors?.['required']">*Postcode is required</div>
                    </div>
                </div>
                
                <br>
                
                <h2 class="form-header">What type of house do you have?</h2>
                
                <mat-radio-group formControlName="houseType" class="flex place-content-evenly">
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['houseType'].errors }" value="0" class="block px-3.5">Apartment</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['houseType'].errors }" value="1" class="block">Closed building</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['houseType'].errors }" value="2" class="block">Semi-detached building</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['houseType'].errors }" value="3" class="block">Open building</mat-radio-button>
                </mat-radio-group>

                <div *ngIf="familyAdress_step && familyAdressCompoundForm.controls['houseType'].errors">
                    <div class="required" *ngIf="familyAddress['houseType'].errors?.['required']">*House type is required</div>
                </div>
                <br>
                <h2 class="form-header">Family Details</h2>
                
                <mat-radio-group formControlName="members" class="flex place-content-evenly">
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['members'].errors }" value="1" class="block">1 person</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['members'].errors }" value="2" class="block">2 persons</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['members'].errors }" value="3" class="block">3 persons</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': familyAdress_step && familyAddress['members'].errors }" value="4" class="block">4 persons or more</mat-radio-button>
                </mat-radio-group>

                <div *ngIf="familyAdress_step && familyAdressCompoundForm.controls['members'].errors">
                    <div class="required" *ngIf="familyAddress['members'].errors?.['required']">*Family Compound is required</div>
                </div>

                <input (click)="previous()" type="button" name="previous" class="previous action-button-previous" value="Previous"/>
                <input  (click)="next()" type="button" name="next" class="next action-button" value="Next"/>
            
            </fieldset>
        </form>
        <!--3rd Form : Meter(s) type -->
        <form [formGroup]="meterTypeForm" id="forms">
            <fieldset *ngIf="step == 3">
                <h2 class="form-header">Meter</h2>
                <label for="metersNumber">How many meters do you have?</label>
                <br>
                <mat-form-field name="metersNumber" appearance="fill" ngDefaultControl  class="flex place-content-evenly">
                    <mat-select formControlName="metersNumber" [(value)]="selectedMeterNr">
                        <mat-option value="1">1 meter</mat-option>
                        <mat-option value="2">2 meters</mat-option>
                        <mat-option value="3" >3 meters</mat-option>
                      </mat-select>
                </mat-form-field>
                <br>
                <div *ngIf="meterType_step && meterTypeForm.controls['metersNumber'].errors">
                    <div class="required" *ngIf="meterType['metersNumber'].errors?.['required']">*Number of meters is required</div>
                </div>
                <br>
                <mat-radio-group *ngIf="selectedMeterNr==1; else elseBlock;" formControlName="meterTypes" class="block">
                    <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                    <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                    <br>
                    <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                        <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                    </div>
                    <br>
                    <mat-form-field name="metersValue">
                        <mat-label>Meter value:</mat-label>
                        <input matInput formControlName="metersValue">
                    </mat-form-field>
                    <br>
                    <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                        <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                    </div>
                </mat-radio-group>

                <ng-template  #elseBlock class="flex place-content-evenly">
                    <div *ngIf="selectedMeterNr==2; else elseBlock2;" class="flex place-content-evenly">
                        <mat-radio-group  formControlName="meterTypes" class="flex place-content-evenly">
                            <div>
                                <div><h3><strong><strong>Meter no.1</strong></strong></h3></div>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                                <br>
                                <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                                    <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                                </div>
                                <br>
                                <mat-form-field name="metersValue">
                                    <mat-label>Meter no.1 value:</mat-label>
                                    <input matInput formControlName="metersValue">
                                </mat-form-field>
                                <br>            
                                <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                                    <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                                </div>
                            </div>
                        </mat-radio-group>
                        <mat-radio-group formControlName="meterTypes" class="flex place-content-evenly">
                            <div>
                                <div><h3><strong>Meter no.2</strong></h3></div>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                                <br>
                                <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                                    <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                                </div>
                                <br>
                                <mat-form-field name="metersValue">
                                    <mat-label>Meter no.2 value:</mat-label>
                                    <input matInput formControlName="metersValue">
                                </mat-form-field>
                                <br>            
                                <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                                    <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                                </div>
                            </div>
                        </mat-radio-group>
                    </div>
                </ng-template>

                <ng-template #elseBlock2 class="flex place-content-evenly">
                    <div class="flex place-content-evenly">
                        <mat-radio-group formControlName="meterTypes" class="flex place-content-evenly">
                            <div>
                                <div><h3><strong>Meter no.1</strong></h3></div>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                                <br>
                                <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                                    <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                                </div>
                                <br>
                                <mat-form-field name="metersValue">
                                    <mat-label>Meter no.1 value:</mat-label>
                                    <input matInput formControlName="metersValue">
                                </mat-form-field>
                                <br>            
                                <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                                    <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                                </div>
                            </div>
                        </mat-radio-group>
                        <mat-radio-group formControlName="meterTypes" class="flex place-content-evenly">
                            <div>
                                <div><h3><strong>Meter no.2</strong></h3></div>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                                <br>
                                <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                                    <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                                </div>
                                <br>
                                <mat-form-field name="metersValue">
                                    <mat-label>Meter no.2 value:</mat-label>
                                    <input matInput formControlName="metersValue">
                                </mat-form-field>
                                <br>            
                                <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                                    <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                                </div>
                            </div>
                        </mat-radio-group>
                        <mat-radio-group formControlName="meterTypes" class="flex place-content-evenly">
                            <div>
                                <div><h3><strong>Meter no.3</strong></h3></div>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="manualMeter" class="block px-3.5">Manual Meter</mat-radio-button>
                                <mat-radio-button [ngClass]="{ 'is-invalid': meterType_step && meterType['meterTypes'].errors }" value="smartMeter" class="block px-3.5">Smart Meter</mat-radio-button>
                                <br>
                                <div *ngIf="meterType_step && meterTypeForm.controls['meterTypes'].errors">
                                    <div class="required" *ngIf="meterType['meterTypes'].errors?.['required']">*Meter Type is required</div>
                                </div>
                                <br>
                                <mat-form-field name="metersValue">
                                    <mat-label>Meter no.3 value:</mat-label>
                                    <input matInput formControlName="metersValue">
                                </mat-form-field>
                                <br>            
                                <div *ngIf="meterType_step && meterTypeForm.controls['metersValue'].errors">
                                    <div class="required" *ngIf="meterType['metersValue'].errors?.['required']">*Meter value is required</div>
                                </div>
                            </div>
                        </mat-radio-group>   
                    </div>                 
                </ng-template>

               
                <br>
                <input (click)="previous()" type="button" name="previous" class="previous action-button-previous" value="Previous"/>
                <input  (click)="next()" type="button" name="next" class="next action-button" value="Next"/>
        
            
            </fieldset>
        </form>
        <!--4th Form : Consumption -->
        <form [formGroup]="consumptionDetailsForm" id="forms">
            <fieldset *ngIf="step == 4">
                <h2 class="form-header">Consumption</h2>
                <label>Check all devices you use frequently:</label>
                <div class="allDevices">
                <div *ngFor="let equipment of equipments; let i=index" class="inline">
                    <input type="checkbox" formArrayName="selectedEquipments" [value]="equipment.value" (change)="onCheckboxChange($event)"/>
                    <strong>{{equipment.name}}</strong>
                </div>
            </div>
                <br>
                <br>
                <h2>DO YOU KNOW YOUR CONSUMPTION?</h2>
                <br>
                <strong>Approximate yearly consumption:</strong>
                <input type="text" formControlName="yearlyConsumption" placeholder="Consumption in kW"/>
                <div *ngIf="consumption_step && consumptionDetailsForm.controls['yearlyConsumption'].errors">
                    <div class="required" *ngIf="consumption['yearlyConsumption'].errors?.['required']">*Consumption is required</div>
                </div>

                <div> 
                    <h2>Estimated daily energy consumption: <span style="color: red;">{{estimation}}khW </span></h2> 
                    <br>
                    <h2>Estimated monthly energy consumption: <span style="color: red;">{{estimation*30}}khW </span></h2>     
                    <br>
                    <h2>Estimated daily energy consumption:<span style="color: red;">{{estimation*365}}khW </span></h2> 
                </div>
                <input (click)="previous()" type="button" name="previous" class="previous action-button-previous" value="Previous"/>
                <input (click)="submit()"type="submit" name="submit" class="submit action-button" value="Submit"/>
            </fieldset>
        </form>
    </div>
</div>